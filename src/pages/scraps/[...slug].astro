---
// src/pages/scraps/[...slug].astro
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Backlinks from '../../components/Backlinks.astro';
import { getAllBacklinks } from '../../utils/backlinks';
import type { BacklinkEntry } from '../../types';

// 動的ルーティングのためのパス生成
export async function getStaticPaths() {
  // scrapsコレクションから全投稿を取得
  const scraps = await getCollection('scraps');
  const allBacklinks = await getAllBacklinks();

  return scraps.map((scrap: CollectionEntry<'scraps'>) => {
    const lookupKey = `scraps/${scrap.slug}`;
    const links = allBacklinks[lookupKey] || [];

    return {
      params: { slug: scrap.slug },
      props: { 
        scrap,
        backlinks: links
      },
    };
  });
}

interface Props {
  scrap: CollectionEntry<'scraps'>;
  backlinks: BacklinkEntry[];
}

const { scrap, backlinks } = Astro.props;
const { Content } = await scrap.render();
---

<BaseLayout title={scrap.data.title}>
  <div class="scrap-container">
    <small>Scrap ID: {scrap.slug}</small>
    <h1>{scrap.data.title}</h1>
    <hr />
    <Content />
    
    <Backlinks backlinks={backlinks} />
  </div>
</BaseLayout>